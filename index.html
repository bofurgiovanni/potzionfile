<!DOCTYPE html>
<html lang="it">
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolatore Codice Fiscale</title>
    <style>
/* Body e font */
body {
    font-family: 'Garamond', serif;
    background-color: #ecf0f1; /* Grigio chiaro */
    color: #2c3e50; /* Blu scuro */
    margin: 0;
    padding: 0;
    background-image: url('GIGLI.jpg'); /* Immagine dei gigli */
    background-repeat: repeat; /* Ripetizione dello sfondo */
}

/* Contenitore principale */
.container {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

/* Titoli */
h1 {
    font-size: 4rem;
    text-align: center;
    color: #830b00;
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Aggiungi ombra al testo */
}


/* Form */
form {
    max-width: 600px;
    margin: 0 auto;
    padding: 40px;
    background-color: rgba(255, 255, 255, 0.9); /* Bianco trasparente */
    border-radius: 20px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}

label {
    display: block;
    font-size: 1.6rem;
    color: #2980b9; /* Blu scuro */
    margin-bottom: 15px;
}

input[type="text"],
select {
    width: calc(100% - 20px);
    padding: 15px;
    margin-bottom: 25px;
    background-color: rgba(255, 255, 255, 0.7); /* Bianco trasparente */
    border: 2px solid #3498db; /* Blu chiaro */
    border-radius: 10px;
    color: #34495e; /* Blu scuro */
    font-size: 1.4rem;
}

select {
    cursor: pointer;
}

button {
    width: 100%;
    padding: 15px;
    background-color: #c0392b; /* Rosso scuro */
    color: #fff;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-size: 1.4rem;
    transition: background-color 0.3s ease;
}

button:hover {
    background-color: #e74c3c; /* Rosso */
}

/* Codice Fiscale */
#codice-fiscale {
    font-size: xx-large;
    color: #2c3e50; /* Blu scuro */
    margin-top: 40px;
    padding: 30px;
    background-color: rgba(255, 255, 255, 0.95); /* Bianco trasparente */
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
}

#codice-fiscale p {
    font-size: 5rem;
    margin: 0;
}

/* Stile per il select */
select {
    width: 100%;
    padding: 15px;
    margin-bottom: 25px;
    border: 2px solid #3498db; /* Blu chiaro */
    border-radius: 10px;
    background-color: rgba(255, 255, 255, 0.7); /* Bianco trasparente */
    color: #34495e; /* Blu scuro */
    font-size: 1.4rem;
}

/* Responsive */
@media screen and (max-width: 600px) {
    form {
        width: 90%;
    }
}

    </style>
    <script>
function calcolaCodiceFiscale() {
    var nome = document.getElementById("nome").value.toUpperCase();
    var cognome = document.getElementById("cognome").value.toUpperCase();
    var dataNascita = document.getElementById("data-nascita").value;
    var sesso = document.getElementById("sesso").value.toUpperCase();
    var giorno = parseInt(dataNascita.substring(0, 2), 10);
    if (sesso === "F" ) {
        giorno += 40;
    }
else{giorno = giorno < 10 ? '0' + giorno : giorno;
}

    var mese = calcolaMese(dataNascita.substring(3, 5));
    var anno = parseInt(dataNascita.substring(8, 10), 10);
anno = anno < 10 ? '0' + anno : anno;

  
  
    var primeTreConsonantiCognome = calcolaPrimeTreConsonantiCognome(cognome);
    var primeTreConsonantiNome = calcolaPrimeTreConsonantiNome(nome);
    
 
    var codiceCatastale = document.getElementById("mySelect").value;


    var codiceFiscaleParziale = primeTreConsonantiCognome + primeTreConsonantiNome + anno + mese + giorno + codiceCatastale;

  
    var ultimaLettera = calcolaUltimaCifra(codiceFiscaleParziale);

 
    var codiceFiscale = codiceFiscaleParziale + ultimaLettera;

    document.getElementById("codice-fiscale").innerHTML = "Il codice fiscale è: " + codiceFiscale;
}




function calcolaCodiceCatastale(input) {
    let inputfile = input.files[0];
    let codiciCatastali = {};

    if (inputfile) {
        const reader = new FileReader();

        reader.readAsText(inputfile);

        reader.onload = function() {
            const testo = reader.result;
            const linee = testo.split("\r\n");

            linee.forEach(linea => {
                const [paese, codice] = linea.split(";");
                codiciCatastali[paese.trim()] = codice.trim(); 
            });

            const selezione = document.getElementById("mySelect");
            selezione.innerHTML = "";

            for (let paese in codiciCatastali) {
                let option = document.createElement("option");
                option.value = codiciCatastali[paese];
                option.text = paese;
                selezione.add(option);
            }
        }
    }
}



function calcolaPrimeTreConsonantiCognome(cognome) {
    var consonanti = "";
    var vocali = "";
    var numConsonanti = 0;
    for (var i = 0; i < cognome.length; i++) {
        var lettera = cognome.charAt(i);
        if ("AEIOU".indexOf(lettera) === -1) { // Se è una consonante
            consonanti += lettera;
            numConsonanti++;
        } else { // Se è una vocale
            vocali += lettera;
        }
        if (numConsonanti === 3) {
            break;
        }
    }
    // Se ci sono meno di tre consonanti, aggiungi vocali
    while (numConsonanti < 3 && vocali.length > 0) {
        consonanti += vocali.charAt(0);
        vocali = vocali.substring(1);
        numConsonanti++;
    }
    // Se ci sono ancora meno di tre consonanti, aggiungi "X"
    while (numConsonanti < 3) {
        consonanti += "X";
        numConsonanti++;
    }
    return consonanti;
}

function calcolaPrimeTreConsonantiNome(nome) {
    var consonanti = "";
    var vocali = "";
    var numConsonanti = 0;
    for (var i = 0; i < nome.length; i++) {
        var lettera = nome.charAt(i);
        if ("AEIOU".indexOf(lettera) === -1) { // Se è una consonante
            consonanti += lettera;
            numConsonanti++;
        } else { // Se è una vocale
            vocali += lettera;
        }
     
    }

    // Se ci sono meno di tre consonanti, aggiungi vocali
    while (numConsonanti < 3 && vocali.length > 0) {
        consonanti += vocali.charAt(0);
        vocali = vocali.substring(1);
        numConsonanti++;
    }
    while (numConsonanti ==3) {
        break
    }

    // Se ci sono ancora meno di tre consonanti, aggiungi "X"
    while (numConsonanti < 3) {
        consonanti += "X";
        numConsonanti++;
    }
    
    // Se ci sono più di tre consonanti, prendi quelle nella posizione 1, 3 e 4
    if (numConsonanti > 3) {
        consonanti = consonanti.charAt(0) + consonanti.charAt(2) + consonanti.charAt(3);
    }

    return consonanti;
}



function calcolaMese(mese) {
    var mesi = {
        "01": "A",
        "02": "B",
        "03": "C",
        "04": "D",
        "05": "E",
        "06": "H",
        "07": "L",
        "08": "M",
        "09": "P",
        "10": "R",
        "11": "S",
        "12": "T"
    };
    return mesi[mese];
}
function calcolaUltimaCifra(codiceFiscaleParziale) {
    const caratteriPari = {
        '0': 0, '1': 1, '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9,
        'A': 0, 'B': 1, 'C': 2, 'D': 3, 'E': 4, 'F': 5, 'G': 6, 'H': 7, 'I': 8, 'J': 9,
        'K': 10, 'L': 11, 'M': 12, 'N': 13, 'O': 14, 'P': 15, 'Q': 16, 'R': 17, 'S': 18, 'T': 19,
        'U': 20, 'V': 21, 'W': 22, 'X': 23, 'Y': 24, 'Z': 25
    };
    const caratteriDispari = {
        '0': 1, '1': 0, '2': 5, '3': 7, '4': 9, '5': 13, '6': 15, '7': 17, '8': 19, '9': 21,
        'A': 1, 'B': 0, 'C': 5, 'D': 7, 'E': 9, 'F': 13, 'G': 15, 'H': 17, 'I': 19, 'J': 21,
        'K': 2, 'L': 4, 'M': 18, 'N': 20, 'O': 11, 'P': 3, 'Q': 6, 'R': 8, 'S': 12, 'T': 14,
        'U': 16, 'V': 10, 'W': 22, 'X': 25, 'Y': 24, 'Z': 23
    };
    const tabellaResti = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25];
    const tabellaLettereControllo = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

    let sum = 0;
    const caratteriArray = codiceFiscaleParziale.split('');
    for (let i = 0; i < caratteriArray.length; i++) {
        let carattere = caratteriArray[i];
        let valore;
        if (i % 2 === 0) { // Caratteri pari
            valore = caratteriDispari[carattere];
            
        } else { // Caratteri dispari
            valore = caratteriPari[carattere];
        }
        sum += valore;
    }

    let resto = sum % 26;
    let letteraControllo = tabellaLettereControllo.charAt(tabellaResti[resto]);

    return letteraControllo;
}


    </script>
</head>
<body>
    <h1>Calcolatore Codice Fiscale Italiano</h1>
    <form>
        <label for="nome">Nome:  scrivi il secondo nome se presente attaccato</label>
        <input type="text" id="nome" required><br>
        
        <label for="cognome">Cognome:</label>
        <input type="text" id="cognome" required><br>
        
        <label for="data-nascita">Data di nascita:</label>
        <input type="text" id="data-nascita" placeholder="GG/MM/AAAA" required><br>
        
        <label for="sesso">Sesso:</label>
        <select id="sesso" required>
            <option value="M">Maschio</option>
            <option value="F">Femmina</option>
        </select><br>

        <input type="file" onchange="calcolaCodiceCatastale(this)">
        <select id="mySelect"></select>
    </form>
    
        
        <button type="button" onclick="calcolaCodiceFiscale()">Calcola Codice Fiscale</button>
       
        <div id="codice-fiscale"></div>
</body>
</html>
